<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>06_EventTarget常见方法</title>
  <style>
    .demo-box {
      width: 200px;
      height: 100px;
      background: #f5f5f5;
      border: 1px solid #ddd;
      margin: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .tip {
      margin: 20px;
      color: #666;
      font-size: 14px;
    }

    button {
      margin: 0 5px;
      padding: 6px 12px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="demo-box" id="targetBox">EventTarget 测试容器</div>
  <div class="btn-group">
    <button id="addBtn">addEventListener 绑定事件</button>
    <button id="removeBtn">removeEventListener 移除事件</button>
    <button id="dispatchBtn">dispatchEvent 触发事件</button>
  </div>
  <p class="tip">控制台查看方法执行效果 →</p>

  <script>
    // 获取核心元素
    const targetBox = document.getElementById('targetBox');
    const addBtn = document.getElementById('addBtn');
    const removeBtn = document.getElementById('removeBtn');
    const dispatchBtn = document.getElementById('dispatchBtn');

    // ========== 核心事件处理函数（复用） ==========
    // 注意：移除事件时必须引用同一个函数，匿名函数无法移除
    function handleClick(event) {
      console.log(`===== ${event.type} 事件触发 =====`);
      console.log('事件类型：', event.type);
      console.log('触发元素：', event.target);
      console.log('自定义数据：', event.detail || '无'); // 自定义事件的附加数据
    }

    // ========== 1. addEventListener() - 绑定事件 ==========
    // 语法：target.addEventListener(事件类型, 处理函数, 配置项/捕获标识)
    addBtn.addEventListener('click', () => {
      // 绑定点击事件（冒泡阶段，默认）
      targetBox.addEventListener('click', handleClick);
      // 绑定鼠标移入事件（捕获阶段，第三个参数为true）
      targetBox.addEventListener('mouseover', handleClick, true);
      // 绑定一次性事件（配置项 { once: true }）
      targetBox.addEventListener('dblclick', handleClick, { once: true });

      console.log('\n===== addEventListener 执行完成 =====');
      console.log('已绑定：click（冒泡）、mouseover（捕获）、dblclick（一次性）');
      targetBox.style.background = '#e8f4f8'; // 视觉反馈
    });

    // ========== 2. removeEventListener() - 移除事件 ==========
    // 语法：target.removeEventListener(事件类型, 处理函数, 捕获标识)
    // 注意：必须和绑定的参数完全一致（事件类型、函数、捕获标识）才能移除
    removeBtn.addEventListener('click', () => {
      // 移除click事件（冒泡阶段）
      targetBox.removeEventListener('click', handleClick);
      // 尝试移除mouseover事件（捕获阶段，需指定第三个参数true）
      targetBox.removeEventListener('mouseover', handleClick, true);

      console.log('\n===== removeEventListener 执行完成 =====');
      console.log('已移除：click（冒泡）、mouseover（捕获）');
      console.log('dblclick（一次性）已自动移除（触发后）');
      targetBox.style.background = '#f5f5f5'; // 恢复样式
    });

    // ========== 3. dispatchEvent() - 手动触发事件 ==========
    // 语法：target.dispatchEvent(事件对象)
    dispatchBtn.addEventListener('click', () => {
      // 3.1 触发原生事件（模拟点击）
      const clickEvent = new MouseEvent('click', {
        bubbles: true, // 是否冒泡
        cancelable: true, // 是否可取消默认行为
        clientX: 100, // 自定义点击坐标
        clientY: 100
      });
      targetBox.dispatchEvent(clickEvent);

      // 3.2 触发自定义事件（自定义名称 + 附加数据）
      const customEvent = new CustomEvent('customEvent', {
        bubbles: true,
        detail: { name: '自定义事件', time: new Date().toLocaleTimeString() } // 附加数据
      });
      // 先绑定自定义事件，再触发
      targetBox.addEventListener('customEvent', handleClick);
      targetBox.dispatchEvent(customEvent);

      console.log('\n===== dispatchEvent 执行完成 =====');
      console.log('已手动触发：原生click事件、自定义customEvent事件');
    });

    // ========== EventTarget 核心总结 ==========
    console.log(`
      【EventTarget 三大核心方法】
      1. addEventListener：绑定事件
         - 参数：事件类型、处理函数、{ capture: 捕获/冒泡, once: 一次性, passive: 禁止preventDefault }
         - 支持绑定多个同类型事件，按绑定顺序执行
      
      2. removeEventListener：移除事件
         - 必须与绑定参数完全一致（事件类型、函数、捕获标识）
         - 匿名函数无法移除，需复用函数引用
      
      3. dispatchEvent：手动触发事件
         - 可触发原生事件（MouseEvent/KeyboardEvent）或自定义事件（CustomEvent）
         - 自定义事件可通过 detail 传递附加数据
      
      【适用对象】
      - DOM元素（div/button等）、Document、Window、XMLHttpRequest 等都继承自 EventTarget
    `);
  </script>
</body>

</html>